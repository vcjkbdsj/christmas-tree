<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ğŸ„ åœ£è¯å¿«ä¹</title>
    <style>
        /* 1. å¼ºåˆ¶æ·±è‰²èƒŒæ™¯ï¼Œé¿å…ç™½å±åˆºçœ¼ */
        body { 
            margin: 0; overflow: hidden; background-color: #000; 
            background: radial-gradient(circle at center, #1a1000 0%, #000000 100%); 
        }
        /* 2. è°ƒè¯•ä¿¡æ¯æ˜¾ç¤ºåŒº (å¦‚æœå‡ºé”™ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ) */
        #debug {
            position: absolute; top: 0; left: 0; color: red; z-index: 100; 
            background: rgba(0,0,0,0.8); padding: 10px; display: none;
        }
        #title {
            position: absolute; top: 15%; width: 100%; text-align: center;
            color: #ffd700; font-size: 24px; font-weight: bold; letter-spacing: 5px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8); pointer-events: none;
            font-family: "Times New Roman", serif;
        }
        #tips {
            position: absolute; bottom: 10%; width: 100%; text-align: center;
            color: rgba(255, 255, 255, 0.5); font-size: 14px; pointer-events: none;
        }
    </style>
    
    <script src="https://cdn.staticfile.org/three.js/r128/three.min.js"></script>
</head>
<body>

    <div id="debug"></div>
    <div id="title">MERRY CHRISTMAS</div>
    <div id="tips">âœ¨ ç‚¹å‡»å±å¹•èšæ‹¢ | æ»‘åŠ¨æ—‹è½¬ âœ¨</div>
    
    <div id="canvas-container" style="width:100%; height:100%; position:absolute; top:0; left:0; z-index:1;"></div>

    <script>
        // --- é”™è¯¯æ•æ‰ç³»ç»Ÿ ---
        window.onerror = function(msg, url, line) {
            const debugEl = document.getElementById('debug');
            debugEl.style.display = 'block';
            debugEl.innerHTML += "é”™è¯¯: " + msg + "<br>";
        };

        // æ£€æŸ¥ Three.js æ˜¯å¦åŠ è½½æˆåŠŸ
        if (typeof THREE === 'undefined') {
            document.getElementById('debug').style.display = 'block';
            document.getElementById('debug').innerHTML = "è‡´å‘½é”™è¯¯ï¼šThree.js å¼•æ“åŠ è½½å¤±è´¥ï¼è¯·æ£€æŸ¥ç½‘ç»œæˆ–æ›´æ¢ WiFiã€‚";
        }

        // --- æ­£å¸¸é€»è¾‘å¼€å§‹ ---
        try {
            const container = document.getElementById('canvas-container');
            const scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x000000, 0.03);

            const camera = new THREE.PerspectiveCamera(65, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 0, 14);

            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.shadowMap.enabled = true;
            container.appendChild(renderer.domElement);

            // ç¯å…‰
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            const dirLight = new THREE.DirectionalLight(0xffd700, 2.5);
            dirLight.position.set(5, 10, 7);
            dirLight.castShadow = true;
            scene.add(dirLight);

            // æè´¨
            const goldMat = new THREE.MeshStandardMaterial({ color: 0xffcc00, metalness: 0.9, roughness: 0.1 });
            const redMat = new THREE.MeshStandardMaterial({ color: 0xaa0000, metalness: 0.5, roughness: 0.4 });

            // ç²’å­ç³»ç»Ÿ
            const group = new THREE.Group();
            scene.add(group);
            const allMesh = [];
            const count = 600;

            const boxGeo = new THREE.BoxGeometry(0.7, 0.7, 0.7);
            const sphereGeo = new THREE.SphereGeometry(0.4, 16, 16);

            for (let i = 0; i < count; i++) {
                // å½¢çŠ¶
                const mesh = new THREE.Mesh(Math.random()>0.3 ? boxGeo : sphereGeo, Math.random()>0.3 ? goldMat : redMat);
                
                // ä½ç½®Aï¼šæ•£å¼€
                const r = 12;
                mesh.userData.posOpen = new THREE.Vector3(
                    (Math.random()-0.5)*r*2, (Math.random()-0.5)*r*2, (Math.random()-0.5)*r*1.5
                );

                // ä½ç½®Bï¼šæ ‘
                const p = i / count; 
                const angle = p * Math.PI * 22 + i * 0.1;
                const radius = (1 - p) * 5.0;
                mesh.userData.posTree = new THREE.Vector3(
                    Math.cos(angle)*radius, p * 10 - 5, Math.sin(angle)*radius
                );

                mesh.position.copy(mesh.userData.posOpen); // é»˜è®¤æ•£å¼€
                mesh.userData.speed = Math.random() * 0.02;

                group.add(mesh);
                allMesh.push(mesh);
            }

            // é¡¶éƒ¨æ˜Ÿæ˜Ÿ
            const star = new THREE.Mesh(new THREE.OctahedronGeometry(1.2), new THREE.MeshBasicMaterial({color:0xffff00}));
            star.userData.posOpen = new THREE.Vector3(0, 15, 0);
            star.userData.posTree = new THREE.Vector3(0, 5.5, 0);
            star.position.copy(star.userData.posOpen);
            group.add(star);
            allMesh.push(star);

            // äº¤äº’çŠ¶æ€
            let isTree = false;
            let progress = 0;

            // --- æ ¸å¿ƒäº¤äº’ä¿®å¤ ---
            
            // 1. ç‚¹å‡»åˆ‡æ¢
            document.body.addEventListener('click', function() {
                isTree = !isTree;
            });

            // 2. æ»‘åŠ¨æ—‹è½¬
            let lastX = 0;
            let rotY = 0;
            
            document.body.addEventListener('touchstart', function(e) {
                lastX = e.touches[0].clientX;
            }, {passive: false});

            document.body.addEventListener('touchmove', function(e) {
                const currentX = e.touches[0].clientX;
                rotY += (currentX - lastX) * 0.01;
                lastX = currentX;
                // ä¸é˜»æ­¢é»˜è®¤äº‹ä»¶ï¼Œé˜²æ­¢å¡æ­»ï¼Œä½†å¦‚æœéœ€è¦é˜»æ­¢æ»šåŠ¨å¯ä»¥åŠ ä¸Š e.preventDefault()
            }, {passive: false});

            // åŠ¨ç”»
            function animate() {
                requestAnimationFrame(animate);

                // åˆ‡æ¢åŠ¨ç”»
                const target = isTree ? 1 : 0;
                progress += (target - progress) * 0.05;

                allMesh.forEach(m => {
                    m.position.lerpVectors(m.userData.posOpen, m.userData.posTree, progress);
                    m.rotation.y += m.userData.speed;
                });

                // æ—‹è½¬é€»è¾‘
                group.rotation.y += 0.002; // è‡ªåŠ¨
                group.rotation.y += (rotY - group.rotation.y) * 0.1; // æ‰‹åŠ¨è·Ÿéš

                renderer.render(scene, camera);
            }
            animate();

            // è°ƒæ•´çª—å£
            window.addEventListener('resize', function() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });

        } catch (err) {
            document.getElementById('debug').style.display = 'block';
            document.getElementById('debug').innerHTML += "JSè¿è¡Œé”™è¯¯: " + err.message;
        }
    </script>
</body>
</html>
